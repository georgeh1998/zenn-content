---
title: "Jetpack Composeã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’é€£å‹•ã•ã›ã‚‹"
emoji: "ğŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["android", "kotlin", "jetpackcompose", "coordinatorlayout"]
published: false
---

# ã¯ã˜ã‚ã«

[Coordinatorlayout](https://developer.android.com/jetpack/androidx/releases/coordinatorlayout)ã‚’ Jetpack Compose ã§å®Ÿè£…ã—ãŸã„ï¼
[ã„ã‚ã„ã‚ãª CoordinatorLayout ãƒ‘ã‚¿ãƒ¼ãƒ³](https://qiita.com/ymshun/items/190527ffff55356ffb9e)ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€CoordinatorLayout ã¨è¨€ã£ã¦ã‚‚è‰²ã€…ãªç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã®è¨˜äº‹ã§ã¯ã€ã€Œç”»é¢ã®ä¸‹ã«ç§»å‹•ã™ã‚‹ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ãŒæ¶ˆãˆã‚‹ã€ç”»é¢ã®ä¸Šã«ç§»å‹•ã™ã‚‹ã¨ã©ã®ä½ç½®ã§ã‚‚ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€ã¨ã„ã†ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ Jetpack Compose ã§ä½œæˆã—ã¦ã¿ã¾ã™ã€‚

@[youtube](Ju_ivS2o5fM)

# LazyLayout ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã‚’è¨ˆç®—ã—ã‚ˆã†

å‰è¿°ã®é€šã‚Šã€CoordinatorLayout ã¨è¨€ã£ã¦ã‚‚ã€ã„ãã¤ã‹ã®ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚
ã—ã‹ã—åŸºæœ¬çš„ã« LazyColumn ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã«å¿œã˜ã¦ã€ç‰¹å®šã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ã‚µã‚¤ã‚ºã‚„è¦‹ãŸç›®ãŒå¤‰æ›´ã•ã‚Œã¾ã™ã€‚
ãªã®ã§ LazyColumn ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å–å¾—ã§ãã‚Œã°è‰¯ã„ã®ã§ã™ã€‚
ã€€.
ã€€.
LazyColumn ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã‚’ç°¡å˜ã«è¨ˆç®—ã™ã‚‹æ–¹æ³•ãŒãªã„ã®ã§ã™ã€‚(ã‚ã£ãŸã‚‰æ•™ãˆã¦ãã ã•ã„ï½)
ãã‚“ãªç§ã¯ `LazyListState` ã‹ã‚‰ã”ã‚ŠæŠ¼ã—ã—ã¦ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å–å¾—ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚
ã—ã‹ã—ãã®æ—¥ã®å¤¢ã®ä¸­ã€èª°ã‹ãŒæ•™ãˆã¦ãã‚Œã¾ã—ãŸã€‚
ã€ŒModifier.scrollable ä½¿ã£ã¦ã¿ãŸã‚‰ï¼Ÿã€
ã€€.
ã€€.
ã¨ã„ã†ã“ã¨ã§ `Modifier.scrollable` ã‚’ä½¿ã†æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚
(`LazyListState`ã‹ã‚‰è¨ˆç®—ã™ã‚‹æ–¹æ³•ã¯ãŠã¾ã‘ã«è¼‰ã›ã¦ãŠãã¾ã™ã€‚)

```kotlin
val lazyState = rememberLazyListState()
val scrollableState = rememberScrollableState(consumeScrollDelta = {
    lazyState.scrollBy(-it)  // need coroutine scope
    it
})
LazyColumn(
    modifier = Modifier
        .scrollable(
            orientation = Orientation.Vertical,
            state = scrollableState
        ),
    state = lazyState,
    userScrollEnabled = false
) {
    ...
}
```

`Modifier.scrollable`ã‹ã‚‰å–å¾—ã—ãŸã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã«å¿œã˜ã¦ã€LazyColumn ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã›ã¾ã™ã€‚
ã—ãŸãŒã£ã¦ã€LazyColumn ã®`userScrollEnabled`ã‚’ false ã«ã—ã¦ãŠãã¾ã™ã€‚ã“ã†ã™ã‚‹ã“ã¨ã§`ScrollableState`ã‹ã‚‰ç”Ÿã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã™ã€‚(`scrollBy`ã¯ Coroutine ãŒå¿…è¦ã§ã™ãŒã€çœç•¥ã—ã¦ã„ã¾ã™ã€‚)
è‹¥å¹²ãƒˆãƒªãƒƒã‚­ãƒ¼ãªæ–¹æ³•ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

# header ã® position ã‚’æ›´æ–°ã—ã‚ˆã†

1. ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•ã‚’ dp ã¨ px ã§ç”¨æ„ã™ã‚‹ã€‚(ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•ãŒå‹•çš„ã®å ´åˆã¯ãŠã¾ã‘ã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚)
2. ãƒ˜ãƒƒãƒ€ãƒ¼ã® position ã‚’ State ã¨ã—ã¦ä¿æŒã™ã‚‹ã€‚æœ€åˆã®ä½ç½®ã‚’ 0 ã¨ã™ã‚‹ã€‚
3. `ScrollableState`ã®ãƒ©ãƒ ãƒ€ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ã¦ã€headerPosition ã‚’æ›´æ–°ã™ã‚‹ã€‚ãã®ã¨ã`coerceIn`ã§ä¸Šé™ã¨ä¸‹é™ã‚’æ±ºã‚ã‚‹ã“ã¨ã§ã€ã€Œç”»é¢ã®ä¸‹ã«ç§»å‹•ã™ã‚‹ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ãŒæ¶ˆãˆã‚‹ã€ç”»é¢ã®ä¸Šã«ç§»å‹•ã™ã‚‹ã¨ã©ã®ä½ç½®ã§ã‚‚ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€ã‚’é”æˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```kotlin
val headerHeightDp = 49.dp
var headerPositionPx by remember { mutableStateOf(0) }
val density = LocalDensity.current
val headerHeightPx = with(density) { headerHeightDp.toPx() }.toInt()
val scrollableState = rememberScrollableState(consumeScrollDelta = {
    scope.launch { lazyState.scrollBy(-it) }
    headerPositionPx = (headerPositionPx + it.toInt()).coerceIn(-headerHeightPx, 0)
    it
})

Box(modifier = Modifier.fillMaxSize()) {
    LazyColumn(
        modifier = Modifier
            .scrollable(
                orientation = Orientation.Vertical,
                state = scrollableState
            ),
        contentPadding = PaddingValues(top = headerHeightDp),
        ...
    ) { ... }

    // Header
    Row(
        Modifier
            .offset { IntOffset(0, headerPositionPx) }
            .height(headerHeightDp)
    ) { ... }
}

```

# æˆæœç‰©

:::details å…¨ä½“ã®ã‚³ãƒ¼ãƒ‰

```kotlin
@Composable
fun ComposeCoordinateLayoutSample() {
    val lazyState = rememberLazyListState()
    val scope = rememberCoroutineScope()
    val headerHeight = 56.dp
    var headerPositionPx by remember { mutableStateOf(0) }
    val density = LocalDensity.current
    val headerHeightPx = with(density) { headerHeight.toPx() }.toInt()
    val scrollableState = rememberScrollableState(consumeScrollDelta = {
        scope.launch { lazyState.scrollBy(-it) }
        headerPositionPx = (headerPositionPx + it.toInt()).coerceIn(-headerHeightPx, 0)
        it
    })

    Box(modifier = Modifier.fillMaxSize()) {
        LazyColumn(
            modifier = Modifier
                .fillMaxSize()
                .scrollable(
                    orientation = Orientation.Vertical,
                    state = scrollableState
                ),
            contentPadding = PaddingValues(top = headerHeightDp),
            state = lazyState,
            userScrollEnabled = false
        ) {
            lazyItems()
        }
        Row(
            Modifier
                .offset { IntOffset(0, headerPositionPx) }
                .height(headerHeightDp)
                .fillMaxWidth()
                .background(Color(0xFFEEEEEE))
            , horizontalArrangement = Arrangement.Center
            , verticalAlignment = Alignment.CenterVertically
        ) {
            Text(text = "HEADER")
        }
    }
}
```

:::

# ã¾ã¨ã‚
