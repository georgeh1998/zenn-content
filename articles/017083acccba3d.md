---
title: "Androidã§è¯éº—ã«æ–‡å­—åˆ—ã‚’æ‰±ã† Sealed interfaces + Extension functions"
emoji: "ğŸ‘‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["android", "kotlin"]
published: false
---


### ã¯ã˜ã‚ã«

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–‹ç™ºã«ãŠã„ã¦ä½•ã‚‰ã‹ã®æ–‡å­—åˆ—ã‚’è¡¨ç¤ºã™ã‚‹éš›ã€å¤§ããåˆ†ã‘ã‚‹ã¨ã€Œã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å—ã‘å–ã£ãŸæ–‡å­—åˆ—ã€ã¨ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ä¿æŒã—ã¦ã„ã‚‹æ–‡å­—åˆ—ã€ãŒã‚ã‚Šã¾ã™ã€‚
Androidé–‹ç™ºã§ã¯ã€ç‰¹ã«å¾Œè€…ã®æ–‡å­—åˆ—ã«ã¯ä¸€æ„ã®IDãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã€åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ä¿æŒã•ã‚Œã¾ã™ã€‚é–‹ç™ºä¸­ã¯Androidã®ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ãŒå‰²ã‚Šå½“ã¦ãŸã“ã‚Œã‚‰ã®æ–‡å­—åˆ—ã¯Intå‹ã®IDã‚’é€šã—ã¦å–å¾—ã—ã¾ã™ã€‚

ã¤ã¾ã‚Šã€ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å—ã‘å–ã£ãŸæ–‡å­—åˆ—ã€ã¯ String å‹ã§ã‚ã‚‹ã®ã«å¯¾ã—ã€ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ä¿æŒã—ã¦ã„ã‚‹æ–‡å­—åˆ—ã€ã¯ Int å‹ã¨ã—ã¦æ‰±ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
UIå´ã§ã“ã‚Œã‚‰ã‚’åŒºåˆ¥ã™ã‚‹ã¨æœ¬è³ªã§ã¯ãªã„éƒ¨åˆ†ã®å‡¦ç†ãŒç…©é›‘ã«ãªã‚‹ãŸã‚ã€é¿ã‘ãŸã„ã¨æ€ã†æ–¹ã¯å°‘ãªããªã„ã¨æ€ã„ã¾ã™ã€‚

å¯¾ç­–ã¨ã—ã¦ã¯æ§˜ã€…ãªæ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€[AndroidDagashi](https://androiddagashi.github.io/)ã®[#349 2024-10-20](https://androiddagashi.github.io/issue/349-2024-10-20/)ã®[Clean Strings Handling in Android](https://proandroiddev.com/clean-strings-handling-in-android-483aa9aa0e94)ã®æ–¹æ³•ã¯ã€å€‹äººçš„ã«ã¯å¥½ããªä¸€ã¤ã§ã™ã€‚

åˆ¥ã®æ–¹æ³•ã¨ã—ã¦ã¯ã€`ApplicationContext` ãªã©ã‚’ä½¿ã£ã¦IDã‹ã‚‰æ–‡å­—åˆ—ã‚’è¿”å´å¯èƒ½ãªã‚¯ãƒ©ã‚¹ã‚’ViewModelãªã©ã¸DIã™ã‚‹æ–¹æ³•ã‚‚è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

### è¨˜äº‹ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹å®Ÿè£…æ–¹æ³•

å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªSealed interfaceã‚’å®šç¾©ã—ã¾ã™ã€‚(å‘½åãªã©ã¯å°‘ã—å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚)

```kt
sealed interface StringWrapper {
    val text: String
        @Composable
        get() = when(this) {
            is Str -> value
            is Res -> stringResource(resId)
        }
    fun getString(context: Context): String = when (this) {
        is Str -> value
        is Res -> context.getString(resId)
    }
    data class Str(val value: String) : StringWrapper
    data class Res(@StringRes val resId: Int) : StringWrapper
}
```

Composableå†…ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚

```kt
@Composable
fun MyText(
    stringWrapper: StringWrapper
) {
    Text(text = stringWrapper.text)
}
```

ã¾ãŸFragmentå†…ã§ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§æ–‡å­—åˆ—ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```kt
class MyFragment: Fragment() {
    fun doSomething(stringWrapper: StringWrapper) {
        val str = stringWrapper.getString(requireContext())
        println(str)
    }
}
```

ã“ã‚Œã«ã‚ˆã‚ŠUIå´ã§ã¯ã€ãã®æ–‡å­—åˆ—ãŒã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å—ã‘å–ã£ãŸæ–‡å­—åˆ—ã€ã‹ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ä¿æŒã—ã¦ã„ã‚‹æ–‡å­—åˆ—ã€ã‹ã‚’æ°—ã«ã›ãšä½¿ç”¨ã§ãã¾ã™ã€‚


### Contextã‚’æ¸¡ã™ã®ãŒã‚¤ãƒã‚¤ãƒ

æ­£ç›´ã“ã“ã¾ã§ã®å†…å®¹ã§å…¨ãå•é¡Œãªã„ã®ã§ã™ãŒã€ä»¥ä¸‹ã®éƒ¨åˆ†ã§å¼•æ•°ã«Contextã‚’æ¸¡ã—ã¦ã„ã‚‹ã®ãŒã‚¤ãƒã‚¤ãƒã—ã£ãã‚Šãã¾ã›ã‚“ã€‚

```kt
fun getString(context: Context): String = when (this) {
    is Str -> value
    is Res -> context.getString(resId)
}
```

æ‹¡å¼µé–¢æ•°ã¨ã‚¹ã‚³ãƒ¼ãƒ—é–¢æ•°ã®1ã¤ã§ã‚ã‚‹ with ã‚’ä½¿ãˆã°ã€ã‚ˆã‚Šã‚¹ãƒãƒ¼ãƒˆã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚
ã¾ãšã¯Fragmentç”¨ã®æ‹¡å¼µé–¢æ•°ã‚’ä½¿ã„ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã™ã€‚

```diff kt
sealed interface StringWrapper {
    val text: String
        @Composable
        get() = when(this) {
            is Str -> value
            is Res -> stringResource(resId)
        }
-     fun getString(context: Context): String = when (this) {
-         is Str -> value
-         is Res -> context.getString(resId)
-    }
+    fun Fragment.getString(): String
+    data class Str(val value: String) : StringWrapper {
+        override fun Fragment.getString(): String = value
+    }
+    data class Res(@StringRes val resId: Int) : StringWrapper {
+        override fun Fragment.getString(): String {
+            return getString(resId)
+        }
+    }
}
```

å‘¼ã³å‡ºã—å´ã®Fragmentã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã§ãã¾ã™ã€‚

```diff kt
class MyFragment: Fragment() {
    fun doSomething(stringWrapper: StringWrapper) {
-        val str = stringWrapper.getString(requireContext())
+        val str = with(stringWrapper) { getString() }
        println(str)
    }
}
```

ä»¥ä¸Šã€å°ã•ãªTipsã¨è¦‹ã›ã‹ã‘ã¦è¨˜è¿°é‡ã¯æ¸›ã‚‰ãšã€ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ã‹ã¯å¾®å¦™ã€‚è‡ªå·±æº€è¶³ã§ã—ãŸã€‚
