---
title: "retrofitã¨xml"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["android", "kotlin", "retrofit", "okhttp"]
published: false
---

# ã¯ã˜ã‚ã«

retrofit ã§ xml ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹æ–¹æ³•ã§ã™ã€‚

# ç’°å¢ƒ

ä»¥ä¸‹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```gradle
implementation("com.squareup.retrofit2:retrofit:2.9.0")
```

# ã‚„ã‚‹ã“ã¨

1. Converter ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚‹
2. (1)ã® Factory ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚‹
3. Retrofit ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«(2)ã‚’ç™»éŒ²ã™ã‚‹

# 1. Converter ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚‹

- `retrfit.Converter`ã‚’å®Ÿè£…ã—ã¾ã™ã€‚generics ã¯ä¸€ã¤ç›®ãŒ`okhttp3.ResponseBody`ã€äºŒã¤ç›®ãŒé–‹ç™ºè€…ãŒçµæœã¨ã—ã¦å—ã‘å–ã‚ŠãŸã„ç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã«ãªã‚Šã¾ã™ã€‚

```kt
class RssResponseConverter: Converter<ResponseBody, RssApiModel> {

    private val parser = JunctionParser()

    override fun convert(value: ResponseBody): RssApiModel {
        val bs = value.string().byteInputStream()
        return parser.parse(bs)
    }
}
```

# 2. Factory ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚‹

```kt
class RssConverterFactory private constructor(): Converter.Factory() {
    override fun responseBodyConverter(
        type: Type,
        annotations: Array<out Annotation>,
        retrofit: Retrofit
    ): Converter<ResponseBody, *> {
        return RssResponseConverter()
    }

    companion object {
        fun create() = RssConverterFactory()
    }
}
```

# 3. Retrofit ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ç™»éŒ²ã™ã‚‹

```kt
@Module
@InstallIn(SingletonComponent::class)
object NetworkModule {

    @Singleton
    @Provides
    fun provideXmlRetrofit(): Retrofit {
        return Retrofit.Builder()
            .baseUrl("YOUR-URL")
            .addConverterFactory(RssConverterFactory.create())
            .build()
    }
}
```
